coh√©rence de fil rouge (par exemple : contr√¥le d‚Äôune petite pi√®ce industrielle, ou d‚Äôun lot de capsules plastiques).


## üß© **Fil rouge global (4 TP r√©capitul√©s)**

| TP | Th√®me                  | Comp√©tences cl√©s                        |
| -- | ---------------------- | --------------------------------------- |
| 1  | Cha√Æne d‚Äôacquisition   | Capteur, r√©glages, dynamique            |
| 2  | Optique                | Grandissement, profondeur de champ, FTM |
| 3  | √âclairage              | Spectre, r√©flectance, g√©om√©trie         |
| 4  | Traitement et d√©cision | Segmentation, mesure, inspection        |



---

# üß™ **TP1 ‚Äì Introduction √† la cha√Æne d‚Äôacquisition d‚Äôimage**

## üéØ Objectifs p√©dagogiques

√Ä la fin du TP, l‚Äô√©tudiant est capable de :

* Identifier les √©l√©ments d‚Äôune cha√Æne de vision industrielle.
* Acqu√©rir et visualiser des images √† l‚Äôaide d‚Äôune cam√©ra industrielle (PyPylon + OpenCV).
* Comprendre l‚Äôimpact des param√®tres de cam√©ra : r√©solution, exposition, gain, profondeur binaire.
* Comparer capteur monochrome et couleur.

---

## üîß Mat√©riel

* PC avec Python ‚â• 3.9 et les packages : `pypylon`, `opencv-python`, `numpy`, `matplotlib`, `tkinter` (pour IHM simple).
* Cam√©ra Basler (ou √©quivalent compatible Pylon), capteur **CMOS couleur** et **monochrome**.
* Objectif 25‚Äì50 mm.
* Quelques objets simples : pi√®ce m√©canique, connecteur, √©tiquette, bille, etc.
* √âclairage constant (ring ou lumi√®re diffuse).

---

## üïì **D√©roul√© (4h)**

| Temps       | √âtape                                              | Description                                                                                                |
| ----------- | -------------------------------------------------- | ---------------------------------------------------------------------------------------------------------- |
| 0h00 ‚Äì 0h20 | **Introduction**                                   | Pr√©sentation de la cha√Æne d‚Äôacquisition, architecture mat√©rielle, types d‚Äôapplications industrielles.      |
| 0h20 ‚Äì 0h40 | **Installation et test de la cam√©ra**              | V√©rification de la connexion, test d‚Äôune capture brute avec `pypylon`.                                     |
| 0h40 ‚Äì 1h30 | **Acquisition d‚Äôimages avec param√®tres variables** | Variation de l‚Äôexposition, du gain, de la r√©solution, de la profondeur de bits. Observation et discussion. |
| 1h30 ‚Äì 2h30 | **Comparaison couleur / mono**                     | Captures de la m√™me sc√®ne avec les deux cam√©ras, comparaison du contraste, du bruit, de la fid√©lit√©.       |
| 2h30 ‚Äì 3h30 | **Mesures et calculs simples**                     | Histogrammes, dynamique, SNR approximatif. Introduction au calcul de contraste (Michelson).                |
| 3h30 ‚Äì 4h00 | **Synth√®se et discussion**                         | Questions de r√©flexion et mini-rapport sur les param√®tres influents.                                       |

---

## üìÑ **Sujet √©tudiant**

### Partie 1 ‚Äî D√©couverte de la cam√©ra

1. Connectez la cam√©ra via PyPylon et capturez une image.
2. Affichez l‚Äôimage avec OpenCV.
3. Sauvegardez une image PNG et observez sa taille en pixels et en octets.

### Partie 2 ‚Äî Influence des param√®tres

1. Faites varier :

   * **exposition** (temps d‚Äôint√©gration),
   * **gain** (amplification),
   * **binarit√©** (8 bits vs 12 bits),
   * **r√©solution** (ROI ou binning).
2. Pour chaque param√®tre :

   * Acqu√©rez une image,
   * Tracez l‚Äôhistogramme,
   * Notez les diff√©rences de contraste, de bruit et de nettet√©.

### Partie 3 ‚Äî Comparaison mono / couleur

1. Prenez une m√™me sc√®ne avec une cam√©ra monochrome et une cam√©ra couleur.
2. Convertissez l‚Äôimage couleur en niveaux de gris (`cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)`), comparez visuellement.
3. Calculez le rapport signal/bruit approximatif sur une zone uniforme.

### Partie 4 ‚Äî Analyse quantitative

1. Calculez le **contraste de Michelson** sur une mire √† bandes claires/sombres :
   ( C = \frac{I_{max} - I_{min}}{I_{max} + I_{min}} )
2. Comparez pour diff√©rentes expositions.
3. Interpr√©tez : quand le contraste se d√©grade-t-il ? pourquoi ?

---

## üíª **√âl√©ments de code / correction**

### 1Ô∏è‚É£ Acquisition d‚Äôune image

```python
from pypylon import pylon
import cv2, numpy as np

# Ouverture de la cam√©ra
camera = pylon.InstantCamera(pylon.TlFactory.GetInstance().CreateFirstDevice())
camera.Open()

# R√©glages de base
camera.Width.SetValue(1280)
camera.Height.SetValue(1024)
camera.ExposureTime.SetValue(5000)  # ¬µs

# Capture
camera.StartGrabbingMax(1)
grab = camera.RetrieveResult(5000, pylon.TimeoutHandling_ThrowException)
if grab.GrabSucceeded():
    img = grab.Array
    cv2.imshow("Image", img)
    cv2.waitKey(0)
grab.Release()
camera.Close()
```

---

### 2Ô∏è‚É£ Histogramme et analyse du contraste

```python
import matplotlib.pyplot as plt

gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
hist = cv2.calcHist([gray],[0],None,[256],[0,256])
plt.plot(hist)
plt.title("Histogramme")
plt.show()

Imax, Imin = np.max(gray), np.min(gray)
C = (Imax - Imin) / (Imax + Imin)
print(f"Contraste de Michelson = {C:.3f}")
```

---

### 3Ô∏è‚É£ Comparaison mono / couleur

```python
img_gray = cv2.cvtColor(img_color, cv2.COLOR_BGR2GRAY)
diff = cv2.absdiff(img_gray, img_mono)
cv2.imshow("Diff√©rence", diff)
cv2.waitKey(0)
```

---

### 4Ô∏è‚É£ Interface simple pour jouer avec les param√®tres

*(√† utiliser en bonus pour l‚ÄôIHM)*

```python
import tkinter as tk
from tkinter import ttk

def update_exposure(val):
    camera.ExposureTime.SetValue(float(val))
    print("Exposure:", val)

root = tk.Tk()
slider = ttk.Scale(root, from_=1000, to=20000, orient='horizontal', command=update_exposure)
slider.pack()
root.mainloop()
```

---

## üß† **Questions de r√©flexion**

1. Pourquoi le bruit augmente-t-il avec le gain ?
2. Pourquoi la dynamique d‚Äôun capteur 12 bits n‚Äôest-elle pas toujours utile ?
3. Dans quelle application industrielle le capteur couleur serait-il pr√©f√©rable ? le capteur mono ?

---

